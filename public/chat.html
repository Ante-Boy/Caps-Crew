<!-- cpf.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>RAW PROTOCOL Chat</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="css/style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
</head>
<body class="bg-dark text-light">
  <canvas id="matrixCanvas"></canvas>
  <!-- Navbar -->
  <nav class="navbar navbar-dark glass-dark sticky-top px-3">
    <button class="btn btn-outline-light d-md-none me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#userSidebar">â˜°</button>
    <span class="navbar-brand mb-0 h1 d-flex align-items-center">
      <img id="groupIcon" src="/group-icons/default-group.png" class="rounded-circle me-2" style="width:32px;height:32px;"/>
      <span id="groupNameSpan">RAW PROTOCOL</span>
    </span>
    <div class="ms-auto d-flex align-items-center">
      <div class="notification-system me-3 position-relative">
        <div id="notificationBell" class="notification-bell" tabindex="0" role="button">
          <i class="fas fa-bell"></i>
          <span id="notificationCount" class="notification-count">0</span>
        </div>
        <div id="notificationPanel" class="notification-panel">
          <div class="d-flex justify-content-between align-items-center p-2 border-bottom">
            <h6 class="m-0 text-info">Notifications</h6>
            <div>
              <button id="markAllRead" class="btn btn-sm btn-outline-success me-1">Mark All</button>
              <button id="deleteAllNotifications" class="btn btn-sm btn-outline-danger">Delete All</button>
            </div>
          </div>
          <div id="notificationList" class="notification-list p-2 text-light" style="max-height:400px; overflow-y:auto;">
            <div class="text-muted text-center">No notifications</div>
          </div>
        </div>
      </div>
      <button id="adminPanelBtn" class="btn btn-outline-light btn-sm me-2" style="display:none">Admin</button>
      <button class="btn btn-outline-light btn-sm me-2" onclick="openSettings()">ðŸ‘¤</button>
      <button class="btn btn-outline-danger btn-sm" onclick="logout()">Logout</button>
    </div>
  </nav>
  <div class="container-fluid h-100">
    <div class="row h-100">
      <aside class="col-lg-2 d-none d-lg-block glass-dark p-0 overflow-auto" style="height: 100vh;">
        <div id="onlineUsers" class="list-group list-group-flush"></div>
      </aside>
      <div class="offcanvas offcanvas-start glass-dark text-light" id="userSidebar" tabindex="-1">
        <div class="offcanvas-header">
          <h5 class="offcanvas-title">Users</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body p-0">
          <div id="onlineUsersMobile" class="list-group list-group-flush"></div>
        </div>
      </div>
      <main class="col-lg-10 d-flex flex-column glass p-0">
        <div id="chat" class="flex-grow-1 overflow-auto p-3 message-container"></div>

        <!-- Chat Lock Banner -->
        <div id="chatLockBanner" style="display:none; margin: 5px 10px; border-radius: 4px;"></div>

        <form id="chatForm" class="d-flex gap-2 p-2 border-top glass" autocomplete="off">
          <input type="file" id="fileInput" hidden/>
          <button type="button" class="btn btn-outline-light" title="Attach file" onclick="document.getElementById('fileInput').click()">ðŸ“Ž</button>
          <input type="text" id="messageInput" class="form-control" placeholder="Type your message..." required/>
          <button type="submit" class="btn btn-success px-4">Send</button>
        </form>
      </main>
    </div>
  </div>
  <!-- User Settings Modal -->
  <div class="modal fade" id="userSettingsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <form class="modal-content" onsubmit="saveSettings(); return false;">
        <div class="modal-header">
          <h5 class="modal-title">Account Settings</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="text-center mb-3">
            <img id="current-avatar" src="/avatars/default.png" class="rounded-circle" style="width:64px;height:64px;"/>
            <input type="file" id="new-avatar-file" class="form-control form-control-sm mt-2" accept="image/*"/>
          </div>
          <input id="settings-username" class="form-control mb-2" placeholder="Username" required/>
          <input id="settings-email" type="email" class="form-control mb-2" placeholder="Email"/>
          <input id="settings-oldpin" type="password" class="form-control mb-2" placeholder="Old PIN"/>
          <input id="settings-newpin" type="password" class="form-control mb-2" placeholder="New PIN"/>
          <input id="settings-oldpass" type="password" class="form-control mb-2" placeholder="Old Password"/>
          <input id="settings-newpass" type="password" class="form-control mb-2" placeholder="New Password"/>
          <div id="settings-msg" class="text-danger small"></div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary px-4">Save</button>
          <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
  <!-- Context menu -->
  <div id="context-menu" class="context-menu"></div>
  <!-- Toast container -->
  <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1080;"></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="js/matrix.js"></script>
  <script src="js/notifications.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
